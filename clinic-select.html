<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¥½å¥åº·è¨ºæ‰€ï½œç·šä¸Šæ›è™Ÿ</title>
  <meta name="description" content="å¥½å¥åº·è¨ºæ‰€ç·šä¸Šæ›è™Ÿæœå‹™" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ¥</text></svg>">
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    :root{--bg:#0b1020;--fg:#e5e7eb;--muted:#9aa3b2;--card:#0f172a;--border:#1f2937;--accent:#60a5fa;--ok:#34d399;--warn:#fbbf24;--err:#f87171;--radius:14px}
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';background:var(--bg);color:var(--fg);line-height:1.6}
    .container{max-width:980px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;background:rgba(11,16,32,.6);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border);z-index:20}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#8b5cf6)}
    main{padding:32px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .hero{display:grid;grid-template-columns:1.2fr 1fr;gap:20px;align-items:center}
    .hero h1{margin:0 0 8px;font-size:clamp(24px,4vw,40px)}
    .hero p{margin:0;color:var(--muted)}
    .notice{display:flex;gap:10px;align-items:flex-start;border-left:4px solid var(--warn);padding:12px 14px;background:#2a1f0b22;border-radius:10px}
    form{padding:18px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    label{display:block;font-weight:600;margin:8px 0 6px}
    input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0c1328;color:var(--fg)}
    input[type="date"]{padding:10px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .slot{padding:10px 12px;border:1px solid var(--border);border-radius:999px;cursor:pointer;user-select:none}
    .slot.active{background:var(--accent);color:#041226}
    .slot.disabled{opacity:.45;pointer-events:none}
    .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:14px}
    .btn{appearance:none;border:0;border-radius:999px;padding:12px 18px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--accent);color:#041226}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--fg)}
    .muted{color:var(--muted)}
    .terms{display:flex;gap:10px;align-items:flex-start;margin-top:8px}
    .footer{padding:24px;color:var(--muted);border-top:1px solid var(--border);text-align:center}
    dialog{border:1px solid var(--border);border-radius:16px;background:var(--card);color:var(--fg);max-width:560px;width:calc(100% - 24px)}
    dialog::backdrop{background:rgba(0,0,0,.5)}
    .success{border-left:4px solid var(--ok);padding:12px 14px;background:#05281555;border-radius:10px}
    .danger{border-left:4px solid var(--err);padding:12px 14px;background:#28050b55;border-radius:10px}
    @media (max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
  
    /* è¡Œå‹•è£ç½®æœ€ä½³åŒ– */
    /* é¿å… iOS è¼¸å…¥æ¡†è‡ªå‹•æ”¾å¤§ï¼šç¢ºä¿å­—é«” >= 16px */
    input, select, textarea, button { font-size:16px; }
    /* è§¸æ§å¯é»å€å¡Šé«˜åº¦ */
    .slot, .btn { min-height:44px; }
    /* æ™‚æ®µæ”¹ç”¨è‡ªé©æ‡‰ç¶²æ ¼ï¼Œé¿å…æ›è¡Œè·‘ç‰ˆ */
    #slots { display:grid; grid-template-columns:repeat(auto-fill,minmax(110px,1fr)); gap:10px; }
    .slot { width:100%; text-align:center; }
    /* Header/Container å®‰å…¨å€ï¼ˆç€æµ·ã€å°è¦½åˆ—ï¼‰ */
    header { padding-left: max(12px, env(safe-area-inset-left)); padding-right: max(12px, env(safe-area-inset-right)); }
    body { padding-bottom: env(safe-area-inset-bottom); }
    /* å°è¢å¹•æ’ç‰ˆèˆ‡é–“è· */
    @media (max-width: 768px){
      .container{ padding:16px; }
      main{ padding:16px 0; }
      .hero{ grid-template-columns:1fr; gap:14px; }
      .card{ border-radius:12px; }
      .actions{ flex-direction:column; align-items:stretch; }
      .actions .btn { width:100%; }
    }
    @media (max-width: 420px){
      .nav{ flex-direction:column; align-items:flex-start; gap:6px; }
      .brand{ font-size:16px; }
      .notice{ font-size:14px; }
      label{ font-size:14px; }
    }
    /* Dialog å¯¬åº¦èˆ‡æ»¾å‹• */
    dialog{ max-width:640px; width:calc(100% - 24px); }
    dialog .container{ max-height:70vh; overflow:auto; }
    </style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <span class="logo" aria-hidden="true"></span>
      <span id="clinicTitle">å¥½å¥åº·è¨ºæ‰€ï½œç·šä¸Šæ›è™Ÿ</span>
    </div>
    <nav class="muted">æœå‹™æ™‚é–“ï¼šé€±ä¸€è‡³é€±å…­ 09:00â€“12:00ã€14:00â€“17:00ã€18:30â€“21:00</nav>
  </div>
</header>
<main class="container">
  <section class="hero">
    <div>
      <h1>å¿«é€Ÿå®Œæˆæ›è™Ÿï¼Œç¾å ´å ±åˆ°æ›´é †æš¢</h1>
      <p>æ­¤ç³»çµ±ç‚ºç¤ºç¯„ç”¨éœæ…‹é é¢ï¼Œä¸æœƒå¯¦éš›é€å‡ºè³‡æ–™ï¼›è‹¥è¦ä¸²æ¥é™¢æ‰€ç³»çµ±æˆ– LINE å®˜æ–¹å¸³è™Ÿï¼Œè«‹äº¤ç”±å·¥ç¨‹ç«¯æ¥ API å¾Œå°ã€‚</p>
      <div class="notice" style="margin-top:12px"><strong>æé†’ï¼š</strong><span>åŒä¸€å¤©åƒ…èƒ½ä¿ç•™ä¸€å€‹æ™‚æ®µï¼Œè«‹æ–¼é–€è¨ºé–‹å§‹å‰ 10 åˆ†é˜åˆ°ç¾å ´å ±åˆ°ä»¥å®Œæˆçœ‹è¨ºåºä½ã€‚</span></div>
    </div>
    <div class="card">
      <form id="regForm" novalidate>
        <div class="grid">
          <div>
            <label for="dept">ç§‘åˆ¥</label>
            <select id="dept" required>
              <option value="">â€” è«‹é¸æ“‡ â€”</option>
              <option value="fm">å®¶é†«ç§‘</option>
              <option value="im">å…§ç§‘</option>
              <option value="ped">å°å…’ç§‘</option>
              <option value="derm">çš®è†šç§‘</option>
            </select>
          </div>
          <div>
            <label for="doctor">é†«å¸«</label>
            <select id="doctor" required disabled>
              <option value="">â€” å…ˆé¸ç§‘åˆ¥ â€”</option>
            </select>
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="date">çœ‹è¨ºæ—¥æœŸ</label>
            <input type="date" id="date" required />
          </div>
          <div>
            <label>é–€è¨ºæ™‚æ®µ</label>
            <div id="slots" class="row" role="listbox" aria-label="å¯é¸æ™‚æ®µ"></div>
            <input type="hidden" id="slotValue" required />
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="name">å§“å</label>
            <input type="text" id="name" placeholder="ç‹å°æ˜" required />
          </div>
          <div>
            <label for="nid">èº«åˆ†è­‰æœ«å››ç¢¼ / NHI å¡æœ«å››ç¢¼</label>
            <input type="text" id="nid" inputmode="numeric" pattern="\\d{4}" placeholder="4 ç¢¼æ•¸å­—" required />
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="phone">æ‰‹æ©Ÿè™Ÿç¢¼</label>
            <input type="tel" id="phone" placeholder="09xx-xxx-xxx" pattern="^0\\d{9}$" required />
          </div>
          <div>
            <label for="note">å°±é†«å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
            <input type="text" id="note" placeholder="ç—‡ç‹€ã€ç”¨è—¥æé†’ç­‰" />
          </div>
        </div>
        <div class="terms">
          <input type="checkbox" id="agree" required />
          <label for="agree" class="muted">æˆ‘å·²é–±è®€ä¸¦åŒæ„<a href="#" id="openPolicy">ã€Œéš±ç§æ¬Šèˆ‡å°±é†«å‘ŠçŸ¥äº‹é …ã€</a>ï¼Œä¸¦åŒæ„æ–¼é–€è¨ºé–‹å§‹å‰å®Œæˆå ±åˆ°ã€‚</label>
        </div>
        <div id="errorBox" class="danger" style="display:none;margin-top:10px"></div>
        <div class="actions">
          <button type="reset" class="btn btn-ghost">æ¸…é™¤</button>
          <button type="submit" class="btn btn-primary">é€å‡ºæ›è™Ÿ</button>
        </div>
      </form>
    </div>
  </section>

  <section class="card" style="margin-top:18px;padding:16px">
    <details>
      <summary><strong>å¸¸è¦‹å•é¡Œ</strong></summary>
      <p class="muted">æ­¤ç‚ºç¤ºç¯„é ï¼Œå¯¦éš›é™¢æ‰€å¯ä¾è¦å®šèª¿æ•´å–è™Ÿè¦å‰‡ã€å–æ¶ˆ/æ”¹æœŸæ™‚é™ã€æ…¢ç®‹é ˜è—¥èˆ‡å¥ä¿å¡å¯¦åç­‰ã€‚</p>
    </details>
  </section>
</main>

<dialog id="policy">
  <form method="dialog" class="container" style="padding:20px">
    <h3 style="margin-top:0">éš±ç§æ¬Šèˆ‡å°±é†«å‘ŠçŸ¥äº‹é …</h3>
    <p class="muted">æœ¬é é¢åƒ…ç¤ºç¯„å‰ç«¯æ“ä½œï¼›æäº¤ä¸æœƒå‚³è‡³ä¼ºæœå™¨ã€‚æ­£å¼ä¸Šç·šæ™‚ï¼Œå€‹è³‡å°‡ä¾å€‹è³‡æ³•èˆ‡é†«ç™‚æ³•è¦å®šä¿è­·ï¼Œåƒ…æ–¼é†«ç™‚æœå‹™å¿…è¦ç¯„åœå…§ä½¿ç”¨ã€‚</p>
    <div class="actions"><button class="btn btn-primary">æˆ‘äº†è§£</button></div>
  </form>
</dialog>

<dialog id="result">
  <div class="container" style="padding:20px">
    <div id="resultBox" class="success"></div>
    <div class="actions" style="margin-top:12px;justify-content:space-between">
      <button id="saveIcs" class="btn btn-ghost">åŠ å…¥è¡Œäº‹æ›†ï¼ˆ.icsï¼‰</button>
      <button id="closeResult" class="btn btn-primary">å®Œæˆ</button>
    </div>
  </div>
</dialog>

<footer class="footer">Â© <span id="year"></span> <span id="clinicFooter">å¥½å¥åº·è¨ºæ‰€</span> Â· ç¤ºç¯„ç”¨ç·šä¸Šæ›è™Ÿé é¢</footer>

<script>
    // === æ–°å¢ï¼šè®€å– URL çš„ clinic åƒæ•¸ï¼Œå‹•æ…‹æ›¿æ›è¨ºæ‰€åç¨± ===
  function getClinicFromQuery(){
    const params = new URLSearchParams(location.search);
    return (params.get('clinic') || '').trim();
  }
  const clinicName = getClinicFromQuery() || 'å¥½å¥åº·è¨ºæ‰€';

  // æ”¹ç€è¦½å™¨åˆ†é æ¨™é¡Œã€SEO æè¿°ï¼ˆå¯é¸ï¼‰
  document.title = `${clinicName}ï½œç·šä¸Šæ›è™Ÿ`;
  const desc = document.querySelector('meta[name="description"]');
  if (desc) desc.setAttribute('content', `${clinicName}ç·šä¸Šæ›è™Ÿæœå‹™`);

  // æ”¹é é¢å¯è¦‹æ–‡å­—
  window.addEventListener('DOMContentLoaded', () => {
    const t = document.getElementById('clinicTitle');
    const f = document.getElementById('clinicFooter');
    if (t) t.textContent = `${clinicName}ï½œç·šä¸Šæ›è™Ÿ`;
    if (f) f.textContent = clinicName;
  });


  const doctors = {
    fm: [{id:'liu', name:'åŠ‰å®¶å®‰ é†«å¸«', slots:['09:10','09:20','09:40','14:10','14:30','18:40','19:00']}],
    im: [{id:'chen', name:'é™³æ€¡å› é†«å¸«', slots:['09:10','09:30','09:50','14:10','14:20','19:10']}],
    ped:[{id:'wu',  name:'å³æŸç¿° é†«å¸«', slots:['09:00','09:20','14:00','14:20','18:40']}],
    derm:[{id:'lin', name:'æ—å“å¦¤ é†«å¸«', slots:['10:00','10:20','15:00','15:20','19:40']}]
  };

  const deptEl = document.getElementById('dept');
  const doctorEl = document.getElementById('doctor');
  const dateEl = document.getElementById('date');
  const slotsEl = document.getElementById('slots');
  const slotValue = document.getElementById('slotValue');
  const errorBox = document.getElementById('errorBox');
  const policy = document.getElementById('policy');
  const openPolicy = document.getElementById('openPolicy');
  const result = document.getElementById('result');
  const resultBox = document.getElementById('resultBox');
  const saveIcs = document.getElementById('saveIcs');
  const closeResult = document.getElementById('closeResult');
  document.getElementById('year').textContent = new Date().getFullYear();

  // é è¨­æ—¥æœŸç‚ºä»Šæ—¥+1ï¼ˆé¿å…é¸åˆ°ä»Šæ—¥å·²éæ™‚æ®µï¼‰ï¼Œé™åˆ¶å¯ç´„æœªä¾† 30 å¤©
  const today = new Date();
  today.setDate(today.getDate()+1);
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  dateEl.min = `${yyyy}-${mm}-${dd}`;
  const maxDate = new Date(today); maxDate.setDate(today.getDate()+30);
  dateEl.max = `${maxDate.getFullYear()}-${String(maxDate.getMonth()+1).padStart(2,'0')}-${String(maxDate.getDate()).padStart(2,'0')}`;
  dateEl.value = dateEl.min;

  deptEl.addEventListener('change', () => {
    slotValue.value = '';
    slotsEl.innerHTML = '';
    doctorEl.innerHTML = '<option value=\"\">â€” è«‹é¸æ“‡é†«å¸« â€”</option>';
    const list = doctors[deptEl.value] || [];
    for (const d of list){
      const opt = document.createElement('option');
      opt.value = d.id; opt.textContent = d.name;
      doctorEl.appendChild(opt);
    }
    doctorEl.disabled = list.length === 0;
  });

  doctorEl.addEventListener('change', renderSlots);
  dateEl.addEventListener('change', renderSlots);

  function renderSlots(){
    slotValue.value='';
    slotsEl.innerHTML='';
    errorBox.style.display='none';
    const dept = deptEl.value, docId = doctorEl.value;
    if(!dept || !docId) return;
    const doc = (doctors[dept] || []).find(d => d.id === docId);
    if(!doc) return;
    // æ¨¡æ“¬ï¼šé€±æ—¥ä¼‘è¨º
    const date = new Date(dateEl.value);
    const isSunday = date.getDay() === 0;
    for (const t of doc.slots){
      const btn = document.createElement('button');
      btn.type='button'; btn.className='slot';
      btn.textContent=t;
      if (isSunday) btn.classList.add('disabled');
      btn.addEventListener('click', () => {
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
        btn.classList.add('active'); ensureInView(btn);
        slotValue.value = t;
      });
      slotsEl.appendChild(btn);
    }
  }

  openPolicy.addEventListener('click', (e)=>{ e.preventDefault(); policy.showModal(); });

  function showError(msg){
    errorBox.textContent = msg;
    errorBox.style.display = 'block';
    errorBox.focus();
  }

  document.getElementById('regForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    errorBox.style.display='none';
    const fields = ['dept','doctor','date','slotValue','name','nid','phone','agree'];
    for (const id of fields){
      const el = document.getElementById(id) || (id==='agree' && document.getElementById('agree'));
      if (id==='agree'){ if(!document.getElementById('agree').checked) return showError('è«‹å‹¾é¸åŒæ„æ¢æ¬¾å¾Œå†é€å‡ºã€‚'); continue; }
      if(!el || !el.value){ return showError('è«‹å®Œæ•´å¡«å¯«å¿…å¡«æ¬„ä½ä¸¦é¸æ“‡é–€è¨ºæ™‚æ®µã€‚'); }
      if(el.id==='nid' && !/^\d{4}$/.test(el.value)) return showError('èº«åˆ†è­‰/å¥ä¿å¡æœ«å››ç¢¼è«‹å¡« 4 ç¢¼æ•¸å­—ã€‚');
      if(el.id==='phone' && !/^0\d{9}$/.test(el.value)) return showError('æ‰‹æ©Ÿæ ¼å¼éœ€ç‚º 10 ç¢¼æ•¸å­—ï¼ˆä¾‹å¦‚ 09xxxxxxxxï¼‰ã€‚');
    }
    const deptName = deptEl.options[deptEl.selectedIndex].textContent;
    const docName = doctorEl.options[doctorEl.selectedIndex].textContent;
    const summary = `æ‚¨å·²æˆåŠŸé ç´„ã€Œ${deptName}ï¼${docName}ã€æ–¼ ${dateEl.value} çš„ ${slotValue.value} æ™‚æ®µã€‚\næ­¤é åƒ…ç¤ºç¯„å‰ç«¯ç•«é¢ï¼Œæœªä¸²æ¥å¾Œç«¯ã€‚`;
    resultBox.textContent = summary;
    result.showModal();
  });

  closeResult.addEventListener('click', ()=>result.close());

  // ä¸‹è¼‰ ICS
  saveIcs.addEventListener('click', ()=>{
    const deptName = deptEl.options[deptEl.selectedIndex]?.textContent || 'é–€è¨º';
    const docName = doctorEl.options[doctorEl.selectedIndex]?.textContent || 'é†«å¸«';
    if(!slotValue.value || !dateEl.value) return showError('è«‹å…ˆå®Œæˆæ›è™Ÿé€å‡ºã€‚');
    const [h,m] = slotValue.value.split(':');
    const start = new Date(dateEl.value+'T'+h.padStart(2,'0')+':'+m.padStart(2,'0')+':00');
    const end = new Date(start.getTime()+20*60000); // 20 åˆ†é˜å€é–“
    function toICS(dt){ const y=dt.getFullYear(); const mo=String(dt.getMonth()+1).padStart(2,'0'); const d=String(dt.getDate()).padStart(2,'0'); const hh=String(dt.getHours()).padStart(2,'0'); const mm=String(dt.getMinutes()).padStart(2,'0'); return `${y}${mo}${d}T${hh}${mm}00`; }
    const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Demo Clinic//Online Booking//ZH
BEGIN:VEVENT
UID:${Date.now()}@demo-clinic
DTSTAMP:${toICS(new Date())}
DTSTART:${toICS(start)}
DTEND:${toICS(end)}
SUMMARY:${deptName}é–€è¨ºï¼ˆ${docName}ï¼‰
DESCRIPTION:æ­¤ç‚ºç¤ºç¯„ç”¨æ›è™Ÿè¡Œç¨‹ï¼Œå¯¦éš›çœ‹è¨ºä»¥é™¢æ‰€é€šçŸ¥ç‚ºæº–ã€‚
LOCATION:å¥½å¥åº·è¨ºæ‰€
END:VEVENT
END:VCALENDAR`;
    const blob = new Blob([ics], {type:'text/calendar;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='clinic-booking.ics'; document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1000);
  });

  // å°è¢å¹•ä½¿ç”¨è€…é«”é©—ï¼šé¸åˆ°æ™‚æ®µå¾Œå°‡è¡¨å–®æ“ä½œå€å¸¶å…¥è¦–é‡
  function ensureInView(el){
    if (window.innerWidth < 768){
      el.scrollIntoView({behavior:'smooth', block:'center'});
    }
  }

</script>
</body>
</html>
